-- Create Database
CREATE DATABASE IF NOT EXISTS travel_planner;
USE travel_planner;

-- üë§ USERS TABLE
CREATE TABLE users (
    user_id INT AUTO_INCREMENT PRIMARY KEY,
    fname VARCHAR(50) NOT NULL,
    lname VARCHAR(50) NOT NULL,
    email_id VARCHAR(100) UNIQUE NOT NULL,
    contact_no VARCHAR(15),
    password VARCHAR(100) NOT NULL,
    gender VARCHAR(10),
    houseno VARCHAR(10),
    street VARCHAR(50),
    city VARCHAR(50),
    state VARCHAR(50),
    pincode VARCHAR(10),
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- üèù DESTINATIONS TABLE
CREATE TABLE destinations (
    destination_id INT AUTO_INCREMENT PRIMARY KEY,
    destination_name VARCHAR(100) NOT NULL
);

-- üè® HOTELS TABLE
CREATE TABLE hotels (
    hotel_id INT AUTO_INCREMENT PRIMARY KEY,
    hotel_name VARCHAR(100) NOT NULL,
    rating DECIMAL(2,1) CHECK (rating BETWEEN 0 AND 5)
);

-- ‚úàÔ∏è FLIGHTS TABLE
CREATE TABLE flights (
    flight_id INT AUTO_INCREMENT PRIMARY KEY,
    airline_name VARCHAR(100) NOT NULL
);

-- üì¶ PACKAGES TABLE (linked to Flight, Hotel, Destination)
CREATE TABLE packages (
    package_id INT AUTO_INCREMENT PRIMARY KEY,
    package_name VARCHAR(100) NOT NULL,
    description TEXT,
    duration INT CHECK (duration > 0),  -- in days
    price DECIMAL(10,2) CHECK (price >= 0),
    destination_id INT,
    hotel_id INT,
    flight_id INT,
    FOREIGN KEY (destination_id) REFERENCES destinations(destination_id)
        ON DELETE SET NULL ON UPDATE CASCADE,
    FOREIGN KEY (hotel_id) REFERENCES hotels(hotel_id)
        ON DELETE SET NULL ON UPDATE CASCADE,
    FOREIGN KEY (flight_id) REFERENCES flights(flight_id)
        ON DELETE SET NULL ON UPDATE CASCADE
);

-- üìë BOOKINGS TABLE (links User ‚Üí Package)
CREATE TABLE bookings (
    booking_id INT AUTO_INCREMENT PRIMARY KEY,
    booking_date DATE DEFAULT (CURRENT_DATE),
    amount DECIMAL(10,2) CHECK (amount >= 0),
    user_id INT,
    package_id INT,
    FOREIGN KEY (user_id) REFERENCES users(user_id)
        ON DELETE CASCADE ON UPDATE CASCADE,
    FOREIGN KEY (package_id) REFERENCES packages(package_id)
        ON DELETE CASCADE ON UPDATE CASCADE
);

-- üí≥ PAYMENTS TABLE (links to both Booking and User)
CREATE TABLE payments (
    payment_id INT AUTO_INCREMENT PRIMARY KEY,
    payment_method VARCHAR(50),
    amount DECIMAL(10,2) CHECK (amount >= 0),
    payment_status ENUM('Pending', 'Completed', 'Failed') DEFAULT 'Pending',
    booking_id INT,
    user_id INT,
    payment_date TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (booking_id) REFERENCES bookings(booking_id)
        ON DELETE CASCADE ON UPDATE CASCADE,
    FOREIGN KEY (user_id) REFERENCES users(user_id)
        ON DELETE CASCADE ON UPDATE CASCADE
);


üèùÔ∏è 1. Insert Destinations
INSERT INTO Destination (destination_name) VALUES
    ('Goa'),
    ('Manali'),
    ('Jaipur'),
    ('Kerala'),
    ('Ladakh');

üè® 2. Insert Hotels
INSERT INTO Hotel (hotel_name, rating) VALUES
('Taj Goa Resort', 4.8),
('Snow Valley Inn', 4.5),
('Jaipur Palace', 4.3),
('Backwater Breeze', 4.6),
('Ladakh Heights', 4.7);

‚úàÔ∏è 3. Insert Flights
INSERT INTO Flight (airline_name) VALUES
('Air India'),
('IndiGo'),
('Vistara'),
('SpiceJet'),
('GoAir');

üß≥ Step 2: Insert Packages

Now that your supporting tables are filled, you can add packages by referencing their IDs.
Let‚Äôs assume auto-increment IDs start from 1 for each table.

INSERT INTO Package (package_name, description, duration, price, destination_id, hotel_id, flight_id)
VALUES
('Goa Summer Getaway', '5 days and 4 nights stay at Taj Goa Resort with return flight and beach activities.', 5, 35000, 1, 1, 1),
('Manali Winter Escape', '4 nights of snow adventure at Snow Valley Inn with return airfare.', 4, 28000, 2, 2, 2),
('Royal Jaipur Tour', '3 days in Jaipur with palace visits and cultural shows.', 3, 25000, 3, 3, 3),
('Kerala Backwater Bliss', '6-day luxurious stay at Backwater Breeze with houseboat cruise.', 6, 40000, 4, 4, 4),
('Ladakh Adventure Trip', '7-day trip to Ladakh Heights with trekking and sightseeing.', 7, 55000, 5, 5, 5);


‚úÖ Result:
Each Package now automatically connects to a destination, hotel, and flight by their respective IDs.

üë§ Step 3: Insert a User (for Testing)
INSERT INTO User (fname, lname, email_id, contact_no, password, gender, city, state, pincode)
VALUES ('John', 'Doe', 'john@example.com', '9876543210', '12345', 'Male', 'Mumbai', 'Maharashtra', '400001');

üßæ Step 4: Make a Booking

Say John wants to book the ‚ÄúGoa Summer Getaway‚Äù package (package_id = 1):

INSERT INTO Booking (booking_date, amount, user_id, package_id)
VALUES (CURDATE(), 35000, 1, 1);

üí≥ Step 5: Add a Payment

Once the booking is done, record the payment:

INSERT INTO Payment (payment_method, amount, payment_status, booking_id, user_id)
VALUES ('UPI', 35000, 'Success', 1, 1);